#!/usr/bin/env bash
function sync {
    src=$1
    dst=$2
    opts='-avzr --cvs-exclude --exclude="*.class"'
    echo "Sync from $src to $dst"
    rsync $opts $src $dst 1>/dev/null
}

ssh d "cd git-rep && make -j16 install_protogen-go.mail.ru && make -j16 install_common-go.mail.ru && make -j16 install_stat-go.mail.ru"

FROM="d:git-rep"
TO=~/git-rep

cd $TO

sync $FROM/tmp/contrib/ ./tmp/contrib/
sync $FROM/projects/protogen/python/src.gen/ ./projects/protogen/python/src.gen/
sync $FROM/projects/protogen/java/src.gen/ ./projects/protogen/java/src.gen/
sync $FROM/projects/java/stat/src.gen/ ./projects/java/stat/src.gen/ 

sync $FROM/projects/java/common/src/ru/mail/go/webbase/utils/DomainsLists.java ./projects/java/common/src/ru/mail/go/webbase/utils/DomainsLists.java
sync $FROM/.classpath ./.classpath

sed -i '/contrib\/hadoop-0.20.2-cdh3u4m20\/lib\/commons-lang-2.4.jar/d' .classpath

cd -
